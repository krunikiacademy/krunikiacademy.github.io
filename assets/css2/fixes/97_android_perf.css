/* assets/css2/fixes/97_android_perf.css
   Android-only: prioritize INSTANT TEXT RENDER (no slow reveal)
   No JS / No IMG / No layout edits
*/
@media (hover: none) and (pointer: coarse) {
  @supports not (-webkit-touch-callout: none) {

    /* 1) Avoid smooth scroll overhead */
    html { scroll-behavior: auto !important; }

    /* 2) IMPORTANT: disable staged rendering (fix "text slowly appears") */
    main, section, .panel, .productGrid, .cardGrid {
      content-visibility: visible !important; /* was auto */
      contain-intrinsic-size: auto !important;
      contain: none !important;
    }

    /* 3) Reduce possible "fade-in/scroll" effects that feel laggy on Android */
    * {
      animation: none !important;
      transition: none !important;
    }

    /* 4) Optional: keep scroll behavior stable */
    body { overscroll-behavior: none; }
  }
}

/* ==========================================================================
   Android Performance Patch (NO SPEC REDUCTION)
   Goal: stop blank screen / wave rendering / janky scroll on Android Chrome
   Place at END of 97_android_perf.css
   ========================================================================== */

/* Target: Android Chrome (exclude iOS Safari) */
@supports (-webkit-appearance: none) and (not (-webkit-touch-callout: none)) {

  /* 1) HARD STOP: prevent "blank screen until ready"
     If any older CSS/JS sets body/main opacity/visibility to hide before load,
     this forces immediate paint on Android. */
  html, body {
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* Common containers that are often hidden during preload/fade-in patterns */
  main, .pageMain, .siteMain, .wrapper, .container, .hero, .heroGrid, .heroText {
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* If you have any "loading/preload" classes, neutralize their hiding effect */
  .is-loading, .loading, .preload, .preloader,
  body.is-loading, body.loading, body.preload {
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* 2) Remove scroll jank from smooth scrolling (keeps UX identical, just avoids jank) */
  html { scroll-behavior: auto !important; }

  /* 3) Android text rendering stability (prevents weird delayed text paint) */
  html { -webkit-text-size-adjust: 100%; }
  body {
    text-rendering: optimizeLegibility;
    -webkit-font-smoothing: antialiased;
  }

  /* 4) Reduce "wave" perception caused by heavy transitions during first paint
     (NOT removing stylesâ€”just prevents transition from blocking first paint) */
  body * {
    transition-delay: 0s !important;
  }

  /* 5) Make images decode without blocking layout thread (no quality loss) */
  img {
    height: auto;
    display: block;
    image-rendering: auto;
  }

  /* 6) Prevent sticky/header repaint thrash (common Android issue) */
  .siteHeader, header, nav {
    transform: translateZ(0);
    backface-visibility: hidden;
  }

  /* 7) Reduce tap/scroll latency feeling */
  a, button {
    touch-action: manipulation;
  }
}

/* ==========================================================================
   Android Performance Patch v2 (SUPPORT SET)
   Place AFTER v1 block (END of 97_android_perf.css)
   ========================================================================== */

@supports (-webkit-appearance: none) and (not (-webkit-touch-callout: none)) {

  /* A) Kill common "reveal" hiding patterns that still cause wave rendering
     (these class names are common; harmless if not used) */
  .reveal, .revealUp, .fade, .fadeIn, .slideUp, .anim, .animate,
  [data-anim], [data-animate], [data-reveal],
  .is-revealing, .is-hidden, .hidden, .invisible {
    opacity: 1 !important;
    visibility: visible !important;
    transform: none !important;
  }

  /* If any section/card is animated in by initial opacity/transform, force stable paint */
  section, article, .panel,
  .card, .pCard, .productCard,
  .heroCard, .heroMedia, .heroBanner {
    opacity: 1 !important;
    visibility: visible !important;
  }

  /* B) Prevent heavy filters/backdrop blur from blocking first paint
     (keeps design intact in normal state; only neutralizes if applied via loading states) */
  body.is-loading *, body.loading *, body.preload * {
    filter: none !important;
    backdrop-filter: none !important;
  }

  /* C) Reduce "paint thrash" by isolating heavy blocks (NO visual change) */
  section, article, .panel, .container,
  .card, .pCard, .hero, .footer, .siteHeader {
    contain: layout paint;
  }

  /* D) Improve compositor stability for large text blocks/cards (helps Android render text sooner) */
  .hero, .heroText, .heroGrid,
  .card, .pCard, .productGrid,
  main, .pageMain, .wrapper, .container {
    transform: translateZ(0);
    will-change: transform;
  }

  /* E) Avoid black/blank flash if browser paints before CSS finishes
     (does not change theme if you already set a background; it just ensures a fallback) */
  body {
    background-color: var(--bg, #fff);
  }

  /* F) Faster click/scroll feel (no design change) */
  body {
    overscroll-behavior-y: none;
  }
}
